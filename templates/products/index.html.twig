{# templates/products/index.html.twig #}
{% extends 'base.html.twig' %}
{% block title %}{{ 'products.title'|trans }}{% endblock %}

{% block extra_styles %}
  {{ parent() }}
  <link rel="stylesheet" href="{{ asset('styles/products.css') }}">
{% endblock %}

{% block body %}
<div class="container py-4">

  <div class="d-flex align-items-end justify-content-between mb-3">
    <h1 class="h3 m-0">{{ 'products.title'|trans }}</h1>
    <ul class="nav nav-pills small">
      <li class="nav-item">
        <a class="nav-link {{ range == 'all' ? 'active' : '' }}"
           href="{{ path('app_products') }}">{{ 'products.filters.all'|trans }}</a>
      </li>
      <li class="nav-item">
        <a class="nav-link {{ range == '10-29' ? 'active' : '' }}"
           href="{{ path('app_products', { range: '10-29' }) }}">10–29 €</a>
      </li>
      <li class="nav-item">
        <a class="nav-link {{ range == '29-35' ? 'active' : '' }}"
           href="{{ path('app_products', { range: '29-35' }) }}">29–35 €</a>
      </li>
      <li class="nav-item">
        <a class="nav-link {{ range == '35-50' ? 'active' : '' }}"
           href="{{ path('app_products', { range: '35-50' }) }}">35–50 €</a>
      </li>
    </ul>
  </div>

  {% if products is empty %}
    <div class="alert alert-info">{{ 'Aucun produit.'|trans }}</div>
  {% else %}
    <div class="row g-3">
      {% for p in products %}
        <div class="col-12 col-sm-6 col-md-4 col-lg-3">
          <div class="card h-100 shadow-sm">

            <a href="{{ path('app_product_show', { id: p.id }) }}"
               class="text-decoration-none text-reset">

             {% set imageSrc = p.imageUrl ? asset(p.imageUrl) : asset('images/placeholder.png') %}
<img src="{{ imageSrc }}" class="card-img-top product-img" alt="{{ p.name }}" loading="lazy">


            <div class="card-body d-flex flex-column">
              <h3 class="card-title">{{ p.name }}</h3>

              <div class="d-flex justify-content-between align-items-center mb-3">
                <span class="price">
                  {{ (p.priceEuro is defined ? p.priceEuro : p.price / 100)|number_format(2, ',', ' ') }} €
                </span>
                {% if p.featured %}
                  <span class="badge text-bg-primary">{{ 'products.badge.featured'|trans }}</span>
                {% endif %}
              </div>

              <div class="mt-auto d-grid gap-2">
                <form action="{{ path('app_panier_add', { id: p.id }) }}" method="post" class="m-0">
                  <input type="hidden" name="_token" value="{{ csrf_token('add_to_cart' ~ p.id) }}">
                  <button type="submit" class="btn btn-primary">{{ 'product.add_to_cart'|trans }}</button>
                </form>
                <a href="{{ path('app_product_show', { id: p.id }) }}" class="btn btn-outline-secondary">
                  {{ 'products.details'|trans }}
                </a>
              </div>
            </div>

          </div>
        </div>
      {% endfor %}
    </div>
  {% endif %}

</div>
{% endblock %}
